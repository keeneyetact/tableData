/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Edit=function(t){this.table=t,this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1};Edit.prototype.initializeColumn=function(t){var e=this,o={editor:!1,blocked:!1,check:t.definition.editable,params:t.definition.editorParams||{}};switch(_typeof(t.definition.editor)){case"string":e.editors[t.definition.editor]?o.editor=e.editors[t.definition.editor]:console.warn("Editor Error - No such editor found: ",t.definition.editor);break;case"function":o.editor=t.definition.editor;break;case"boolean":!0===t.definition.editor&&("function"!=typeof t.definition.formatter?e.editors[t.definition.formatter]?o.editor=e.editors[t.definition.formatter]:o.editor=e.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",t.definition.formatter))}o.editor&&(t.modules.edit=o)},Edit.prototype.getCurrentCell=function(){return!!this.currentCell&&this.currentCell.getComponent()},Edit.prototype.clearEditor=function(){var t=this.currentCell;this.invalidEdit=!1,t&&(this.currentCell=!1,t.getElement().removeClass("tabulator-validation-fail"),t.getElement().removeClass("tabulator-editing").empty(),t.row.getElement().classList.remove("tabulator-row-editing"))},Edit.prototype.cancelEdit=function(){if(this.currentCell){var t=this.currentCell,e=this.currentCell.getComponent();this.clearEditor(),t.setValueActual(t.getValue()),t.column.cellEvents.cellEditCancelled&&t.column.cellEvents.cellEditCancelled(e),this.table.options.cellEditCancelled(e)}},Edit.prototype.bindEditor=function(t){var e=this,o=t.getElement();o.attr("tabindex",0),o.on("click",function(t){$(this).hasClass("tabulator-editing")||$(this).focus()}),o.on("mousedown",function(t){e.mouseClick=!0}),o.on("focus",function(o){e.recursionBlock||e.edit(t,o,!1)})},Edit.prototype.focusCellNoEvent=function(t){this.recursionBlock=!0,t.getElement().focus(),this.recursionBlock=!1},Edit.prototype.editCell=function(t,e){this.focusCellNoEvent(t),this.edit(t,!1,e)},Edit.prototype.edit=function(t,e,o){function i(e){if(s.currentCell===t){var o=!0;t.column.modules.validate&&s.table.modExists("validate")&&(o=s.table.modules.validate.validate(t.column.modules.validate,t.getComponent(),e)),!0===o?(s.clearEditor(),t.setValue(e,!0)):(s.invalidEdit=!0,t.getElement().addClass("tabulator-validation-fail"),s.focusCellNoEvent(t),d(),s.table.options.validationFailed(t.getComponent(),e,o))}else console.warn("Edit Success Error - cannot call success on a cell that is no longer being edited")}function n(){s.currentCell===t?s.cancelEdit():console.warn("Edit Success Error - cannot call cancel on a cell that is no longer being edited")}function a(t){d=t}var r,l,s=this,c=!0,d=function(){},u=t.getElement();if(this.currentCell){if(this.invalidEdit)return;return void this.cancelEdit()}if(t.column.modules.edit.blocked)return this.mouseClick=!1,u.blur(),!1;switch(e&&e.stopPropagation(),_typeof(t.column.modules.edit.check)){case"function":c=t.column.modules.edit.check(t.getComponent());break;case"boolean":c=t.column.modules.edit.check}return c||o?(s.cancelEdit(),s.currentCell=t,l=t.getComponent(),this.mouseClick&&(this.mouseClick=!1,t.column.cellEvents.cellClick&&t.column.cellEvents.cellClick(l)),t.column.cellEvents.cellEditing&&t.column.cellEvents.cellEditing(l),s.table.options.cellEditing(l),!1===(r=t.column.modules.edit.editor.call(s,l,a,i,n,t.column.modules.edit.params))?(u.blur(),!1):(u.addClass("tabulator-editing"),t.row.getElement().classList.add("tabulator-row-editing"),u.empty(),u.append(r),d(),u.children().click(function(t){t.stopPropagation()}),!0)):(this.mouseClick=!1,u.blur(),!1)},Edit.prototype.editors={input:function(t,e,o,i,n){var a=$("<input type='text'/>");return a.css({padding:"4px",width:"100%","box-sizing":"border-box"}).val(t.getValue()),e(function(){a.focus(),a.css("height","100%")}),a.on("change blur",function(e){a.val()!=t.getValue()?o(a.val()):i()}),a.on("keydown",function(t){13==t.keyCode&&o(a.val()),27==t.keyCode&&i()}),a},textarea:function(t,e,o,i,n){var a=t.getValue(),r=String("null"==typeof a||void 0===a?"":a),l=(r.match(/(?:\r\n|\r|\n)/g),$("<textarea></textarea>")),s=0;return l.css({display:"block",height:"100%",width:"100%",padding:"2px","box-sizing":"border-box","white-space":"pre-wrap",resize:"none"}).val(r),e(function(){l.focus(),l.css("height","100%")}),l.on("change blur",function(e){l.val()!=t.getValue()?(o(l.val()),setTimeout(function(){t.getRow().normalizeHeight()},300)):i()}),l.on("keyup",function(){l.css({height:""});var e=l[0].scrollHeight;l.css({height:e}),e!=s&&(s=e,t.getRow().normalizeHeight())}),l.on("keydown",function(t){27==t.keyCode&&i()}),l},number:function(t,e,o,i,n){var a=void 0!==n.max?"max='"+n.max+"'":"",r=void 0!==n.min?"min='"+n.min+"'":"",l="step='"+(void 0!==n.step?n.step:1)+"'",s=$("<input type='number' "+a+" "+r+" "+l+"/>");return s.css({padding:"4px",width:"100%","box-sizing":"border-box"}).val(t.getValue()),e(function(){s.css("height","100%"),setTimeout(function(){s.focus()},10)}),s.on("blur",function(e){var n=s.val();isNaN(n)||(n=Number(n)),n!=t.getValue()?o(n):i()}),s.on("keydown",function(t){var e;13==t.keyCode&&(e=s.val(),isNaN(e)||(e=Number(e)),o(e)),27==t.keyCode&&i()}),s},range:function(t,e,o,i,n){var a="max='"+(void 0!==n.max?n.max:10)+"'",r="min='"+(void 0!==n.min?n.min:0)+"'",l="step='"+(void 0!==n.step?n.step:1)+"'",s=$("<input type='range' "+a+" "+r+" "+l+"/>");return s.css({padding:"4px",width:"100%","box-sizing":"border-box"}).val(t.getValue()),e(function(){s.css("height","100%"),setTimeout(function(){s.focus()},10)}),s.on("blur",function(e){var n=s.val();isNaN(n)||(n=Number(n)),n!=t.getValue()?o(n):i()}),s.on("keydown",function(t){var e;13==t.keyCode&&(e=s.val(),isNaN(e)||(e=Number(e)),o(e)),27==t.keyCode&&i()}),s},select:function(t,e,o,i,n){function a(t,e,o,i){var n=$("<option></option>").attr("value",o).text(e);i&&n.prop("disabled",!0),t.append(n)}function r(t,e){var o;e.options?(o=$("<optgroup></optgroup>").attr("label",e.label),e.options.forEach(function(t){r(o,t)}),t.append(o)):a(t,void 0===e.label?e.value:e.label,void 0===e.value?e.label:e.value,e.disabled)}var l=$("<select><select/>"),s=Array.isArray(n);if("function"==typeof n&&(n=n(t),s=Array.isArray(n)),s||"object"!==(void 0===n?"undefined":_typeof(n)))s&&n.forEach(function(t){r(l,t)});else for(var c in n)a(l,n[c],c);return l.css({padding:"4px",width:"100%","box-sizing":"border-box","font-family":""}).val(t.getValue()),e(function(){l.focus().click()}),l.on("change blur",function(t){o(l.val())}),l.on("keydown",function(t){13===t.keyCode&&o(l.val())}),l},star:function(t,e,o,i,n){var a=t.getElement(),r=t.getValue(),l=$("svg",a).length||5,s=$("svg:first",a).attr("width")||14,c=$("<div style='vertical-align:middle; padding:4px; display:inline-block; vertical-align:middle;'></div>"),d=$('<svg width="'+s+'" height="'+s+'" class="tabulator-star-active" viewBox="0 0 512 512" xml:space="preserve" style="padding:0 1px;"><polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/></svg>'),u=$('<svg width="'+s+'" height="'+s+'" class="tabulator-star-inactive" viewBox="0 0 512 512" xml:space="preserve" style="padding:0 1px;"><polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/></svg>'),p=function(t){$(".tabulator-star-active",t.closest("div")).length!=t.prevAll("svg").length+1&&(t.prevAll("svg").replaceWith(d.clone()),t.nextAll("svg").replaceWith(u.clone()),t.replaceWith(d.clone()))};r=parseInt(r)<l?parseInt(r):l;for(var f=1;f<=l;f++){var g=f<=r?d:u;c.append(g.clone())}return c.on("mouseover","svg",function(t){t.stopPropagation(),p($(this))}),c.on("mouseover",function(t){$("svg",$(this)).replaceWith(u.clone())}),c.on("click",function(t){o(0)}),c.on("click","svg",function(t){t.stopPropagation(),o($(this).prevAll("svg").length+1)}),a.css({"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}),a.on("blur",function(){i()}),a.on("keydown",function(t){switch(t.keyCode){case 39:p($(".tabulator-star-inactive:first",c));break;case 37:var e=$(".tabulator-star-active:last",c).prev("svg");e.length?p(e):$("svg",c).replaceWith(u.clone());break;case 13:o($(".tabulator-star-active",c).length);break;case 27:i()}}),c},progress:function(t,e,o,i,n){var a,r=t.getElement(),l=$("div",r).data("max"),s=$("div",r).data("min"),c=(l-s)/100,d=t.getValue()||0,u=$("<div class='tabulator-progress-handle' style='position:absolute; right:0; top:0; bottom:0; width:5px;'></div>"),p=function(){var t=c*Math.round(a.outerWidth()/(r.width()/100))+s;o(t),r.attr("aria-valuenow",t).attr("aria-label",d)};return d=parseFloat(d)<=l?parseFloat(d):l,d=parseFloat(d)>=s?parseFloat(d):s,d=100-Math.round((d-s)/c),a=$("<div style='position:absolute; top:8px; bottom:8px; left:4px; right:"+d+"%; margin-right:4px; background-color:#488CE9; display:inline-block; max-width:100%; min-width:0%;' data-max='"+l+"' data-min='"+s+"'></div>"),r.css({padding:"0 4px"}),r.attr("aria-valuemin",s).attr("aria-valuemax",l),a.append(u),u.on("mousedown",function(t){a.data("mouseDrag",t.screenX),a.data("mouseDragWidth",a.outerWidth())}),u.on("mouseover",function(){$(this).css({cursor:"ew-resize"})}),r.on("mousemove",function(t){a.data("mouseDrag")&&a.css({width:a.data("mouseDragWidth")+(t.screenX-a.data("mouseDrag"))})}),r.on("mouseup",function(t){a.data("mouseDrag")&&(t.stopPropagation(),t.stopImmediatePropagation(),a.data("mouseDragOut",!0),a.data("mouseDrag",!1),a.data("mouseDragWidth",!1),p())}),r.on("keydown",function(t){switch(t.keyCode){case 39:a.css({width:a.width()+r.width()/100});break;case 37:a.css({width:a.width()-r.width()/100});break;case 13:p();break;case 27:i()}}),r.on("blur",function(){i()}),a},tickCross:function(t,e,o,i,n){var a=t.getValue(),r=$("<input type='checkbox'/>");return r.css({"margin-top":"5px","box-sizing":"border-box"}).val(a),"firefox"!=this.table.browser&&e(function(){r.focus()}),!0===a||"true"===a||"True"===a||1===a?r.prop("checked",!0):r.prop("checked",!1),r.on("change blur",function(t){o(r.is(":checked"))}),r.on("keydown",function(t){13==t.keyCode&&o(r.is(":checked")),27==t.keyCode&&i()}),r},tick:function(t,e,o,i,n){var a=t.getValue(),r=$("<input type='checkbox'/>");return r.css({"margin-top":"5px","box-sizing":"border-box"}).val(a),"firefox"!=this.table.browser&&e(function(){r.focus()}),!0===a||"true"===a||"True"===a||1===a?r.prop("checked",!0):r.prop("checked",!1),r.on("change blur",function(t){o(r.is(":checked"))}),r.on("keydown",function(t){13==t.keyCode&&o(r.is(":checked")),27==t.keyCode&&i()}),r}},Tabulator.prototype.registerModule("edit",Edit);