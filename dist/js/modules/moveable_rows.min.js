/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},MoveRows=function(e){this.table=e,this.placeholderElement=$("<div class='tabulator-row tabulator-row-placeholder'></div>"),this.hoverElement=$(),this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.connection=!1,this.connections=[],this.connectedTable=!1,this.connectedRow=!1};MoveRows.prototype.initialize=function(e){this.connection=this.table.options.movableRowsConnectedTables},MoveRows.prototype.setHandle=function(e){this.hasHandle=e},MoveRows.prototype.initializeRow=function(e){var o,t=this,n={};n.mouseup=function(o){t.tableRowDrop(o,e)}.bind(t),n.mousemove=function(o){if(o.pageY-e.element.offset().top+t.table.rowManager.element.scrollTop()>e.getHeight()/2){if(t.toRow!==e||!t.toRowAfter){var n=e.getElement();n.parentNode.insertBefore(t.placeholderElement,n.nextSibling),t.moveRow(e,!0)}}else if(t.toRow!==e||t.toRowAfter){var n=e.getElement();n.parentNode.insertBefore(t.placeholderElement,n),t.moveRow(e,!1)}}.bind(t),this.hasHandle||(o=e.getElement(),o.addEventListener("mousedown",function(o){t.checkTimeout=setTimeout(function(){t.startMove(o,e)},t.checkPeriod)}),o.addEventListener("mouseup",function(e){t.checkTimeout&&clearTimeout(t.checkTimeout)})),e.modules.moveRow=n},MoveRows.prototype.initializeCell=function(e){var o=this,t=e.getElement();t.addEventListener("mousedown",function(t){o.checkTimeout=setTimeout(function(){o.startMove(t,e.row)},o.checkPeriod)}),t.addEventListener("mouseup",function(e){o.checkTimeout&&clearTimeout(o.checkTimeout)})},MoveRows.prototype._bindMouseMove=function(){this.table.rowManager.getDisplayRows().forEach(function(e){"row"===e.type&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})},MoveRows.prototype._unbindMouseMove=function(){this.table.rowManager.getDisplayRows().forEach(function(e){"row"===e.type&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})},MoveRows.prototype.startMove=function(e,o){var t=o.getElement();this.setStartPosition(e,o),this.moving=o,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.css({width:o.getWidth(),height:o.getHeight()}),this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(o)):(t.parentNode.insertBefore(this.placeholderElement[0],t),t.parentNode.removeChild(t)),this.hoverElement=t.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?($("body").append(this.hoverElement),this.hoverElement.css({left:0,top:0,width:this.table.element.clientWidth,"white-space":"nowrap",overflow:"hidden","pointer-events":"none"})):(this.table.rowManager.getTableElement().append(this.hoverElement),this.hoverElement.css({left:0,top:0}),this._bindMouseMove()),$("body").on("mousemove",this.moveHover),$("body").on("mouseup",this.endMove),this.moveHover(e)},MoveRows.prototype.setStartPosition=function(e,o){var t,n;t=o.getElement(),this.connection?(n=t.getBoundingClientRect(),this.startX=n.left-e.pageX+window.scrollX,this.startY=n.top-e.pageY+window.scrollY):this.startY=e.pageY-t.getBoundingClientRect().top},MoveRows.prototype.endMove=function(e){this._unbindMouseMove(),this.connection||(this.placeholderElement.after(this.moving.getElement()),this.placeholderElement.detach()),this.hoverElement.detach(),this.table.element.classList.remove("tabulator-block-select"),this.toRow&&this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,$("body").off("mousemove",this.moveHover),$("body").off("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables())},MoveRows.prototype.moveRow=function(e,o){this.toRow=e,this.toRowAfter=o},MoveRows.prototype.moveHover=function(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)},MoveRows.prototype.moveHoverTable=function(e){var o=this.table.rowManager.getElement(),t=o.scrollTop,n=e.pageY-o.getBoundingClientRect().top+t;this.hoverElement.css({top:n-this.startY})},MoveRows.prototype.moveHoverConnections=function(e){this.hoverElement.css({left:this.startX+e.pageX,top:this.startY+e.pageY})},MoveRows.prototype.connectToTables=function(e){var o=this.table.modules.comms.getConnections(this.connection);this.table.options.movableRowsSendingStart(o),this.table.modules.comms.send(this.connection,"moveRow","connect",{row:e})},MoveRows.prototype.disconnectFromTables=function(){var e=this.table.modules.comms.getConnections(this.connection);this.table.options.movableRowsSendingStop(e),this.table.modules.comms.send(this.connection,"moveRow","disconnect")},MoveRows.prototype.connect=function(e,o){var t=this;return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=o,this.table.element.classList.add("tabulator-movingrow-receiving"),t.table.rowManager.getDisplayRows().forEach(function(e){"row"===e.type&&e.modules.moveRow&&e.modules.moveRow.mouseup&&e.getElement.addEventListener("mouseup",e.modules.moveRow.mouseup)}),t.tableRowDropEvent=t.tableRowDrop.bind(t),t.table.element.addEventListener("mouseup",t.tableRowDropEvent),this.table.options.movableRowsReceivingStart(o,e),!0)},MoveRows.prototype.disconnect=function(e){var o=this;e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),o.table.rowManager.getDisplayRows().forEach(function(e){"row"===e.type&&e.modules.moveRow&&e.modules.moveRow.mouseup&&e.getElement().removeEventListener("mouseup",e.modules.moveRow.mouseup)}),o.table.element.removeEventListener("mouseup",o.tableRowDropEvent),this.table.options.movableRowsReceivingStop(e)):console.warn("Move Row Error - trying to disconnect from non connected table")},MoveRows.prototype.dropComplete=function(e,o,t){var n=!1;if(t){switch(_typeof(this.table.options.movableRowsSender)){case"string":n=this.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender}n?n.call(this,this.moving.getComponent(),o?o.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.table.options.movableRowsSent(this.moving.getComponent(),o?o.getComponent():void 0,e)}else this.table.options.movableRowsSentFailed(this.moving.getComponent(),o?o.getComponent():void 0,e);this.endMove()},MoveRows.prototype.tableRowDrop=function(e,o){var t=!1,n=!1;switch(e.stopImmediatePropagation(),_typeof(this.table.options.movableRowsReceiver)){case"string":t=this.receivers[this.table.options.movableRowsReceiver];break;case"function":t=this.table.options.movableRowsReceiver}t?n=t.call(this,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.table.options.movableRowsReceived(this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable):this.table.options.movableRowsReceivedFailed(this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable),this.table.modules.comms.send(this.connectedTable,"moveRow","dropcomplete",{row:o,success:n})},MoveRows.prototype.receivers={insert:function(e,o,t){return this.table.addRow(e.getData(),void 0,o),!0},add:function(e,o,t){return this.table.addRow(e.getData()),!0},update:function(e,o,t){return!!o&&(o.update(e.getData()),!0)},replace:function(e,o,t){return!!o&&(this.table.addRow(e.getData(),void 0,o),o.delete(),!0)}},MoveRows.prototype.senders={delete:function(e,o,t){e.delete()}},MoveRows.prototype.commsReceived=function(e,o,t){switch(o){case"connect":return this.connect(e,t.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,t.row,t.success)}},Tabulator.prototype.registerModule("moveRow",MoveRows);