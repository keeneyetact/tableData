/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ajax=function(t){this.table=t,this.config=!1,this.url="",this.params=!1,this.loaderElement=this.createLoaderElement(),this.msgElement=this.createMsgElement(),this.loadingElement=!1,this.errorElement=!1,this.progressiveLoad=!1,this.loading=!1,this.requestOrder=0};Ajax.prototype.initialize=function(){this.loaderElement.appendChild(this.msgElement),this.table.options.ajaxLoaderLoading&&(this.loadingElement=this.table.options.ajaxLoaderLoading),this.table.options.ajaxLoaderError&&(this.errorElement=this.table.options.ajaxLoaderError),this.table.options.ajaxParams&&this.setParams(this.table.options.ajaxParams),this.table.options.ajaxConfig&&this.setConfig(this.table.options.ajaxConfig),this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.table.options.ajaxProgressiveLoad&&(this.table.options.pagination?(this.progressiveLoad=!1,console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time")):this.table.modExists("page")?(this.progressiveLoad=this.table.options.ajaxProgressiveLoad,this.table.modules.page.initializeProgressive(this.progressiveLoad)):console.error("Pagination plugin is required for progressive ajax loading"))},Ajax.prototype.createLoaderElement=function(){var t=document.createElement("div");return t.classList.add("tablulator-loader"),t},Ajax.prototype.createMsgElement=function(){var t=document.createElement("div");return t.classList.add("tabulator-loader-msg"),t.setAttribute("role","alert"),t},Ajax.prototype.setParams=function(t,e){if(e){this.params=this.params||{};for(var o in t)this.params[o]=t[o]}else this.params=t},Ajax.prototype.getParams=function(){return this.params||{}},Ajax.prototype.setConfig=function(t){if(this._loadDefaultConfig(),"string"==typeof t)this.config.method=t;else for(var e in t)this.config[e]=t[e]},Ajax.prototype._loadDefaultConfig=function(t){var e=this;if(!e.config||t){e.config={};for(var o in e.defaultConfig)e.config[o]=e.defaultConfig[o]}},Ajax.prototype.setUrl=function(t){this.url=t},Ajax.prototype.getUrl=function(){return this.url},Ajax.prototype.loadData=function(t){this.progressiveLoad?this._loadDataProgressive():this._loadDataStandard(t)},Ajax.prototype.nextPage=function(t){var e;this.loading||(e=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.getElement().clientHeight,t<e&&this.table.modules.page.nextPage())},Ajax.prototype.blockActiveRequest=function(){this.requestOrder++},Ajax.prototype._loadDataProgressive=function(){this.table.rowManager.setData([]),this.table.modules.page.setPage(1)},Ajax.prototype._loadDataStandard=function(t){var e=this;this.sendRequest(function(o){e.table.rowManager.setData(o,t)},t)},Ajax.prototype.serializeParams=function(t,e){var o=this,a=[],i=[];if(e=e||"",Array.isArray(t))t.forEach(function(t,i){a=a.concat(o.serializeParams(t,e?e+"["+i+"]":i))});else if("object"===(void 0===t?"undefined":_typeof(t)))for(var r in t)a=a.concat(o.serializeParams(t[r],e?e+"["+r+"]":r));else a.push({key:e,val:t});return e?a:(a.forEach(function(t){i.push(encodeURIComponent(t.key)+"="+encodeURIComponent(t.val))}),i.join("&"))},Ajax.prototype.sendRequest=function(t,e){var o,a=this,i=a.url;if(!i)return console.warn("Ajax Load Error - No URL Set"),!1;a.requestOrder++,o=a.requestOrder,a._loadDefaultConfig(),a.params&&(a.config.method&&"get"!=a.config.method?a.config.body=JSON.stringify(a.params):i+="?"+a.serializeParams(a.params)),!1!==a.table.options.ajaxRequesting(a.url,a.params)&&(a.loading=!0,e||a.showLoader(),fetch(i,a.config).then(function(e){e.ok?e.json().then(function(i){e.ok&&(o===a.requestOrder?(a.table.options.ajaxResponse&&(i=a.table.options.ajaxResponse(a.url,a.params,i)),t(i)):console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made")),a.hideLoader(),a.loading=!1}).catch(function(t){console.warn("Ajax Load Error - Invalid JSON returned",t),a.showError(),setTimeout(function(){a.hideLoader()},3e3),a.loading=!1}):(console.error("Ajax Load Error - Connection Error: "+e.status,e.statusText),a.table.options.ajaxError(e,e.status,e.statusText),a.showError(),setTimeout(function(){a.hideLoader()},3e3),a.loading=!1)}).catch(function(t){console.error("Ajax Load Error - Connection Error: ",t),a.table.options.ajaxError(t,t,t),a.showError(),setTimeout(function(){a.hideLoader()},3e3),a.loading=!1}))},Ajax.prototype.showLoader=function(){if("function"==typeof this.table.options.ajaxLoader?this.table.options.ajaxLoader():this.table.options.ajaxLoader){for(this.hideLoader();this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.remove("tabulator-error"),this.msgElement.classList.add("tabulator-loading"),this.loadingElement?this.msgElement.appendChild(this.loadingElement):this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|loading"),this.table.element.appendChild(this.loaderElement)}},Ajax.prototype.showError=function(){for(this.hideLoader();this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.remove("tabulator-loading"),this.msgElement.classList.add("tabulator-error"),this.errorElement?this.msgElement.appendChild(this.errorElement):this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|error"),this.table.element.appendChild(this.loaderElement)},Ajax.prototype.hideLoader=function(){this.loaderElement.parentNode&&this.loaderElement.parentNode.removeChild(this.loaderElement)},Ajax.prototype.defaultConfig={method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"}},Tabulator.prototype.registerModule("ajax",Ajax);