/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var Ajax=function(t){this.table=t,this.config=!1,this.url="",this.params=!1,this.loaderElement=$("<div class='tablulator-loader'></div>"),this.msgElement=$("<div class='tabulator-loader-msg' role='alert'></div>"),this.loadingElement=!1,this.errorElement=!1,this.progressiveLoad=!1,this.loading=!1,this.requestOrder=0};Ajax.prototype.initialize=function(){this.loaderElement.append(this.msgElement),this.table.options.ajaxLoaderLoading&&(this.loadingElement=this.table.options.ajaxLoaderLoading),this.table.options.ajaxLoaderError&&(this.errorElement=this.table.options.ajaxLoaderError),this.table.options.ajaxParams&&this.setParams(this.table.options.ajaxParams),this.table.options.ajaxConfig&&this.setConfig(this.table.options.ajaxConfig),this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.table.options.ajaxProgressiveLoad&&(this.table.options.pagination?(this.progressiveLoad=!1,console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time")):this.table.modExists("page")?(this.progressiveLoad=this.table.options.ajaxProgressiveLoad,this.table.modules.page.initializeProgressive(this.progressiveLoad)):console.error("Pagination plugin is required for progressive ajax loading"))},Ajax.prototype.setParams=function(t,e){if(e){this.params=this.params||{};for(var a in t)this.params[a]=t[a]}else this.params=t},Ajax.prototype.getParams=function(){return this.params||{}},Ajax.prototype.setConfig=function(t){if(this._loadDefaultConfig(),"string"==typeof t)this.config.type=t;else for(var e in t)this.config[e]=t[e]},Ajax.prototype._loadDefaultConfig=function(t){var e=this;if(!e.config||t){e.config={};for(var a in e.defaultConfig)e.config[a]=e.defaultConfig[a]}},Ajax.prototype.setUrl=function(t){this.url=t},Ajax.prototype.getUrl=function(){return this.url},Ajax.prototype.loadData=function(t){this.progressiveLoad?this._loadDataProgressive():this._loadDataStandard(t)},Ajax.prototype.nextPage=function(t){var e;this.loading||(e=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.element[0].clientHeight,t<e&&this.table.modules.page.nextPage())},Ajax.prototype.blockActiveRequest=function(){this.requestOrder++},Ajax.prototype._loadDataProgressive=function(){this.table.rowManager.setData([]),this.table.modules.page.setPage(1)},Ajax.prototype._loadDataStandard=function(t){var e=this;this.sendRequest(function(a){e.table.rowManager.setData(a,t)},t)},Ajax.prototype.sendRequest=function(t,e){var a,o=this;if(!o.url)return console.warn("Ajax Load Error - No URL Set"),!1;o.requestOrder++,a=o.requestOrder,o._loadDefaultConfig(),o.config.url=o.url,o.params&&(o.config.data=o.params),!1!==o.table.options.ajaxRequesting(o.url,o.params)&&(o.loading=!0,e||o.showLoader(),$.ajax(o.config).done(function(e){a===o.requestOrder?(o.table.options.ajaxResponse&&(e=o.table.options.ajaxResponse(o.url,o.params,e)),t(e)):console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made"),o.hideLoader(),o.loading=!1}).fail(function(t,e,a){console.error("Ajax Load Error - Connection Error: "+t.status,a),o.table.options.ajaxError(t,e,a),o.showError(),setTimeout(function(){o.hideLoader()},3e3),o.loading=!1}))},Ajax.prototype.showLoader=function(){("function"==typeof this.table.options.ajaxLoader?this.table.options.ajaxLoader():this.table.options.ajaxLoader)&&(this.loaderElement.detach(),this.msgElement.empty().removeClass("tabulator-error").addClass("tabulator-loading"),this.loadingElement?this.msgElement.append(this.loadingElement):this.msgElement.append(this.table.modules.localize.getText("ajax|loading")),this.table.element.append(this.loaderElement))},Ajax.prototype.showError=function(){this.loaderElement.detach(),this.msgElement.empty().removeClass("tabulator-loading").addClass("tabulator-error"),this.errorElement?this.msgElement.append(this.errorElement):this.msgElement.append(this.table.modules.localize.getText("ajax|error")),this.table.element.append(this.loaderElement)},Ajax.prototype.hideLoader=function(){this.loaderElement.detach()},Ajax.prototype.defaultConfig={url:"",type:"GET",async:!0,dataType:"json",success:function(t){}},Tabulator.prototype.registerModule("ajax",Ajax);