/* Tabulator v4.4.3 (c) Oliver Folkerd */
var Persistence=function(e){this.table=e,this.mode="",this.id="",this.config={}};Persistence.prototype.localStorageTest=function(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}},Persistence.prototype.initialize=function(){var e=this.table.options.persistenceMode,t=this.table.options.persistenceID;this.mode=!0!==e?e:this.localStorageTest()?"local":"cookie",this.id="tabulator-"+(t||this.table.element.getAttribute("id")||""),this.config={sort:!0===this.table.options.persistence||this.table.options.persistence.sort,filter:!0===this.table.options.persistence||this.table.options.persistence.filter,group:!0===this.table.options.persistence||this.table.options.persistence.group,page:!0===this.table.options.persistence||this.table.options.persistence.page,columns:!0===this.table.options.persistence?["width","visible"]:this.table.options.persistence.columns}},Persistence.prototype.initializeColumn=function(e){},Persistence.prototype.load=function(e,t){console.log("P Load",e);var i=this.retreiveData(e);return t&&(i=i?this.mergeDefinition(t,i):t),i},Persistence.prototype.retreiveData=function(e){var t="",i=this.id+("columns"===e?"":"-"+e);switch(this.mode){case"local":t=localStorage.getItem(i);break;case"cookie":var s=document.cookie,o=s.indexOf(i+"="),n=void 0;o>-1&&(s=s.substr(o),n=s.indexOf(";"),n>-1&&(s=s.substr(0,n)),t=s.replace(i+"=",""));break;default:console.warn("Persistence Load Error - invalid mode selected",this.mode)}return!!t&&JSON.parse(t)},Persistence.prototype.mergeDefinition=function(e,t){var i=this,s=[];return t=t||[],t.forEach(function(t,o){var n=i._findColumn(e,t);n&&(n.width=t.width,n.visible=t.visible,n.columns&&(n.columns=i.mergeDefinition(n.columns,t.columns)),s.push(n))}),e.forEach(function(e,o){i._findColumn(t,e)||(s.length>o?s.splice(o,0,e):s.push(e))}),s},Persistence.prototype._findColumn=function(e,t){var i=t.columns?"group":t.field?"field":"object";return e.find(function(e){switch(i){case"group":return e.title===t.title&&e.columns.length===t.columns.length;case"field":return e.field===t.field;case"object":return e===t}})},Persistence.prototype.save=function(e){var t={};switch(console.log("P Save",e),e){case"columns":t=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":t=this.table.modules.filter.getFilters();break;case"sort":t=this.validateSorters(this.table.modules.sort.getSort())}var i=this.id+("columns"===e?"":"-"+e);this.saveData(i,t)},Persistence.prototype.validateSorters=function(e){return e.forEach(function(e){e.column=e.field,delete e.field}),e},Persistence.prototype.saveData=function(e,t){switch(t=JSON.stringify(t),this.mode){case"local":localStorage.setItem(e,t);break;case"cookie":var i=new Date;i.setDate(i.getDate()+1e4),document.cookie=e+"="+t+"; expires="+i.toUTCString();break;default:console.warn("Persistence Save Error - invalid mode selected",this.mode)}},Persistence.prototype.parseColumns=function(e){var t=this,i=[];return e.forEach(function(e){var s={};e.isGroup?(s.title=e.getDefinition().title,s.columns=t.parseColumns(e.getColumns())):(s.title=e.getDefinition().title,s.field=e.getField(),s.width=e.getWidth(),s.visible=e.visible),i.push(s)}),i},Tabulator.prototype.registerModule("persistence",Persistence);