/* Tabulator v4.0.5 (c) Oliver Folkerd */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Download=function(t){this.table=t,this.fields={},this.columnsByIndex=[],this.columnsByField={}};Download.prototype.download=function(t,o,e,n){function i(e,i){n?n(e):a.triggerDownload(e,i,t,o)}var a=this,l=!1;"function"==typeof t?l=t:a.downloaders[t]?l=a.downloaders[t]:console.warn("Download Error - No such download type found: ",t),this.processColumns(),l&&l.call(this,a.processDefinitions(),a.processData(),e||{},i)},Download.prototype.processColumns=function(){var t=this;t.columnsByIndex=[],t.columnsByField={},t.table.columnManager.columnsByIndex.forEach(function(o){o.field&&o.visible&&!1!==o.definition.download&&(t.columnsByIndex.push(o),t.columnsByField[o.field]=o)})},Download.prototype.processDefinitions=function(){var t=this,o=[];return t.columnsByIndex.forEach(function(t){var e=t.definition;if(!1!==t.download){var n={};for(var i in e)n[i]=e[i];void 0!==e.downloadTitle&&(n.title=e.downloadTitle),o.push(n)}}),o},Download.prototype.processData=function(){var t=this,o=t.table.rowManager.getData(!0,"download");return"function"==typeof t.table.options.downloadDataFormatter&&(o=t.table.options.downloadDataFormatter(o)),o},Download.prototype.triggerDownload=function(t,o,e,n){var i=document.createElement("a"),a=new Blob([t],{type:o}),n=n||"Tabulator."+("function"==typeof e?"txt":e);(a=this.table.options.downloadReady.call(this.table,t,a))&&(navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(i.setAttribute("href",window.URL.createObjectURL(a)),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)),this.table.options.downloadComplete&&this.table.options.downloadComplete())},Download.prototype.getFieldValue=function(t,o){var e=this.columnsByField[t];return!!e&&e.getFieldValue(o)},Download.prototype.commsReceived=function(t,o,e){switch(o){case"intercept":this.download(e.type,"",e.options,e.intercept)}},Download.prototype.downloaders={csv:function(t,o,e,n){var i,a=this,l=[],r=[],s=e&&e.delimiter?e.delimiter:",";t.forEach(function(t){t.field&&(l.push('"'+String(t.title).split('"').join('""')+'"'),r.push(t.field))}),i=[l.join(s)],o.forEach(function(t){var o=[];r.forEach(function(e){var n=a.getFieldValue(e,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}o.push('"'+String(n).split('"').join('""')+'"')}),i.push(o.join(s))}),n(i.join("\n"),"text/csv")},json:function(t,o,e,n){n(JSON.stringify(o,null,"\t"),"application/json")},pdf:function(t,o,e,n){var i=this,a=[],l=[],r=[],s={},d=e&&e.title?e.title:"",u=e&&"portrait"==e.orientation?"p":"l";t.forEach(function(t){t.field&&(l.push(t.title||""),a.push(t.field))}),o.forEach(function(t){var o=[];a.forEach(function(e){var n=i.getFieldValue(e,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}o.push(n)}),r.push(o)});var c=new jsPDF(u,"pt");e&&e.autoTable&&(s="function"==typeof e.autoTable?e.autoTable(c)||{}:e.autoTable),d&&(s.addPageContent=function(t){c.text(d,40,30)}),c.autoTable(l,r,s),n(c.output("arraybuffer"),"application/pdf")},xlsx:function(t,o,e,n){function i(){var e=[],n=[],i=[];return t.forEach(function(t){t.field&&(e.push(t.title),n.push(t.field))}),i.push(e),o.forEach(function(t){var o=[];n.forEach(function(e){o.push(l.getFieldValue(e,t))}),i.push(o)}),function(){var t={},o={s:{c:0,r:0},e:{c:n.length,r:i.length}};return XLSX.utils.sheet_add_aoa(t,i),t["!ref"]=XLSX.utils.encode_range(o),t}()}var a,l=this,r=e.sheetName||"Sheet1",s={SheetNames:[],Sheets:{}};if(e.sheetOnly)return void n(i());if(e.sheets)for(var d in e.sheets)!0===e.sheets[d]?(s.SheetNames.push(d),s.Sheets[d]=i()):(s.SheetNames.push(d),this.table.modules.comms.send(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},intercept:function(t){s.Sheets[d]=t}}));else s.SheetNames.push(r),s.Sheets[r]=i();a=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"}),n(function(t){for(var o=new ArrayBuffer(t.length),e=new Uint8Array(o),n=0;n!=t.length;++n)e[n]=255&t.charCodeAt(n);return o}(a),"application/octet-stream")}},Tabulator.prototype.registerModule("download",Download);