/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Download=function(o){this.table=o,this.fields={},this.columnsByIndex=[],this.columnsByField={}};Download.prototype.download=function(o,t,e,n){function i(e,i){n?n(e):a.triggerDownload(e,i,o,t)}var a=this,l=!1;"function"==typeof o?l=o:a.downloaders[o]?l=a.downloaders[o]:console.warn("Download Error - No such download type found: ",o),this.processColumns(),l&&l.call(this,a.processDefinitions(),a.processData(),e||{},i)},Download.prototype.processColumns=function(){var o=this;o.columnsByIndex=[],o.columnsByField={},o.table.columnManager.columnsByIndex.forEach(function(t){t.field&&t.visible&&!1!==t.definition.download&&(o.columnsByIndex.push(t),o.columnsByField[t.field]=t)})},Download.prototype.processDefinitions=function(){var o=this,t=[];return o.columnsByIndex.forEach(function(o){var e=o.definition;if(!1!==o.download){var n={};for(var i in e)n[i]=e[i];void 0!==e.downloadTitle&&(n.title=e.downloadTitle),t.push(n)}}),t},Download.prototype.processData=function(){var o=this,t=o.table.rowManager.getData(!0,"download");return"function"==typeof o.table.options.downloadDataFormatter&&(t=o.table.options.downloadDataFormatter(t)),t},Download.prototype.triggerDownload=function(o,t,e,n){var i=document.createElement("a"),a=new Blob([o],{type:t}),n=n||"Tabulator."+("function"==typeof e?"txt":e);(a=this.table.options.downloadReady.call(this.table,o,a))&&(navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(i.setAttribute("href",window.URL.createObjectURL(a)),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)),this.table.options.downloadComplete&&this.table.options.downloadComplete())},Download.prototype.getFieldValue=function(o,t){var e=this.columnsByField[o];return!!e&&e.getFieldValue(t)},Download.prototype.commsReceived=function(o,t,e){switch(t){case"intercept":this.download(e.type,"",e.options,e.intercept)}},Download.prototype.downloaders={csv:function(o,t,e,n){var i,a=this,l=[],s=[],r=e&&e.delimiter?e.delimiter:",";o.forEach(function(o){o.field&&(l.push('"'+String(o.title).split('"').join('""')+'"'),s.push(o.field))}),i=[l.join(r)],t.forEach(function(o){var t=[];s.forEach(function(e){var n=a.getFieldValue(e,o);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}t.push('"'+String(n).split('"').join('""')+'"')}),i.push(t.join(r))}),n(i.join("\n"),"text/csv")},json:function(o,t,e,n){n(JSON.stringify(t,null,"\t"),"application/json")},pdf:function(o,t,e,n){var i=this,a=[],l=[],s=[],r={},u=e&&e.title?e.title:"",d=e&&"portrait"==e.orientation?"p":"l";o.forEach(function(o){o.field&&(l.push(o.title||""),a.push(o.field))}),t.forEach(function(o){var t=[];a.forEach(function(e){var n=i.getFieldValue(e,o);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}t.push(n)}),s.push(t)});var c=new jsPDF(d,"pt");e&&e.autoTable&&("function"==typeof e.autoTable?(console.log("funcs",e.autoTable),r=e.autoTable(c)||{}):(console.log("obj",e.autoTable),r=e.autoTable)),u&&(r.addPageContent=function(o){c.text(u,40,30)}),c.autoTable(l,s,r),n(c.output("arraybuffer"),"application/pdf")},xlsx:function(o,t,e,n){function i(){var e=[],n=[],i=[];return o.forEach(function(o){o.field&&(e.push(o.title),n.push(o.field))}),i.push(e),t.forEach(function(o){var t=[];n.forEach(function(e){t.push(l.getFieldValue(e,o))}),i.push(t)}),function(){var o={},t={s:{c:0,r:0},e:{c:n.length,r:i.length}};return XLSX.utils.sheet_add_aoa(o,i),o["!ref"]=XLSX.utils.encode_range(t),o}()}var a,l=this,s=e.sheetName||"Sheet1",r={SheetNames:[],Sheets:{}};if(e.sheetOnly)return void n(i());if(e.sheets)for(var u in e.sheets)!0===e.sheets[u]?(r.SheetNames.push(u),r.Sheets[u]=i()):(r.SheetNames.push(u),this.table.modules.comms.send(e.sheets[u],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},intercept:function(o){r.Sheets[u]=o}}));else r.SheetNames.push(s),r.Sheets[s]=i();a=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"}),n(function(o){for(var t=new ArrayBuffer(o.length),e=new Uint8Array(t),n=0;n!=o.length;++n)e[n]=255&o.charCodeAt(n);return t}(a),"application/octet-stream")}},Tabulator.prototype.registerModule("download",Download);