/* Tabulator v4.1.0 (c) Oliver Folkerd */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Download=function(o){this.table=o,this.fields={},this.columnsByIndex=[],this.columnsByField={},this.config={}};Download.prototype.download=function(o,t,e,n){function i(e,i){n?n(e):r.triggerDownload(e,i,o,t)}var r=this,s=!1;this.processConfig(),"function"==typeof o?s=o:r.downloaders[o]?s=r.downloaders[o]:console.warn("Download Error - No such download type found: ",o),this.processColumns(),s&&s.call(this,r.processDefinitions(),r.processData(),e||{},i,this.config)},Download.prototype.processConfig=function(){var o=this.table.options.downloadConfig;o.rowGroups&&this.table.options.groupBy&&this.table.modExists("groupRows")&&(this.config.rowGroups=!0),o.columGroups&&this.table.columnManager.columns.length==this.table.columnManager.columnsByIndex.length&&(this.config.columGroups=!0)},Download.prototype.processColumns=function(){var o=this;o.columnsByIndex=[],o.columnsByField={},o.table.columnManager.columnsByIndex.forEach(function(t){t.field&&t.visible&&!1!==t.definition.download&&(o.columnsByIndex.push(t),o.columnsByField[t.field]=t)})},Download.prototype.processDefinitions=function(){var o=this,t=[];return o.columnsByIndex.forEach(function(o){var e=o.definition;if(!1!==o.download){var n={};for(var i in e)n[i]=e[i];void 0!==e.downloadTitle&&(n.title=e.downloadTitle),t.push(n)}}),t},Download.prototype.processData=function(){var o=this,t=this,e=[],n=[];return this.config.rowGroups?(n=this.table.modules.groupRows.getGroups(),n.forEach(function(t){e.push(o.processGroupData(t))})):e=t.table.rowManager.getData(!0,"download"),"function"==typeof t.table.options.downloadDataFormatter&&(e=t.table.options.downloadDataFormatter(e)),e},Download.prototype.processGroupData=function(o){var t=this,e=o.getSubGroups(),n={type:"group",key:o.key};return e.length?(n.subGroups=[],e.forEach(function(o){n.subGroups.push(t.processGroupData(o))})):n.rows=o.getData(!0,"download"),n},Download.prototype.triggerDownload=function(o,t,e,n){var i=document.createElement("a"),r=new Blob([o],{type:t}),n=n||"Tabulator."+("function"==typeof e?"txt":e);(r=this.table.options.downloadReady.call(this.table,o,r))&&(navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(r,n):(i.setAttribute("href",window.URL.createObjectURL(r)),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)),this.table.options.downloadComplete&&this.table.options.downloadComplete())},Download.prototype.getFieldValue=function(o,t){var e=this.columnsByField[o];return!!e&&e.getFieldValue(t)},Download.prototype.commsReceived=function(o,t,e){switch(t){case"intercept":this.download(e.type,"",e.options,e.intercept)}},Download.prototype.downloaders={csv:function(o,t,e,n,i){function r(o){o.forEach(function(o){var t=[];c.forEach(function(e){var n=l.getFieldValue(e,o);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}t.push('"'+String(n).split('"').join('""')+'"')}),a.push(t.join(p))})}function s(o){o.subGroups?o.subGroups.forEach(function(o){s(o)}):r(o.rows)}var a,l=this,u=[],c=[],p=e&&e.delimiter?e.delimiter:",";o.forEach(function(o){o.field&&(u.push('"'+String(o.title).split('"').join('""')+'"'),c.push(o.field))}),a=[u.join(p)],i.rowGroups?(console.warn("Download Warning - CSV downloader cannot process row groups"),t.forEach(function(o){s(o)})):r(t),n(a.join("\n"),"text/csv")},json:function(o,t,e,n,i){n(JSON.stringify(t,null,"\t"),"application/json")},pdf:function(o,t,e,n,i){function r(o){switch(void 0===o?"undefined":_typeof(o)){case"object":o=JSON.stringify(o);break;case"undefined":case"null":o="";break;default:o=o}return o}function s(o){o.forEach(function(o){var t=[];u.forEach(function(e){var n=l.getFieldValue(e,o);t.push(r(n))}),p.push(t)})}function a(o){var t=[];t.push(r(o.key)),f.push(p.length),p.push(t),o.subGroups?o.subGroups.forEach(function(o){a(o)}):s(o.rows)}var l=this,u=[],c=[],p=[],f=[],d={},h={},y=e.jsPDF||{},w=e&&e.title?e.title:"";y.orientation||(y.orientation=e.orientation||"landscape"),y.unit||(y.unit="pt"),o.forEach(function(o){o.field&&(c.push(o.title||""),u.push(o.field))}),i.rowGroups?t.forEach(function(o){a(o)}):s(t);var b=new jsPDF(y);if(e&&e.autoTable&&(d="function"==typeof e.autoTable?e.autoTable(b)||{}:e.autoTable),i.rowGroups){var g=function(o,t){if(f.indexOf(t.row.index)>-1)for(var e in h)o.styles[e]=h[e]};if(h=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},d.createdCell){var m=d.createdCell;d.createdCell=function(o,t){g(o,t),m(o,t)}}else d.createdCell=g}w&&(d.addPageContent=function(o){b.text(w,40,30)}),b.autoTable(c,p,d),n(b.output("arraybuffer"),"application/pdf")},xlsx:function(o,t,e,n,i){function r(){function e(){var o=[];return c.forEach(function(t){o.push({s:{r:t,c:0},e:{r:t,c:l.length-1}})}),o}function n(o){o.forEach(function(o){var t=[];l.forEach(function(e){t.push(a.getFieldValue(e,o))}),u.push(t)})}function r(o){var t=[];t.push(o.key),c.push(u.length),u.push(t),o.subGroups?o.subGroups.forEach(function(o){r(o)}):(console.log("parse",o,o.rows),n(o.rows))}var s=[],l=[],u=[];return o.forEach(function(o){o.field&&(s.push(o.title),l.push(o.field))}),u.push(s),i.rowGroups?t.forEach(function(o){r(o)}):n(t),function(){var o={},t={s:{c:0,r:0},e:{c:l.length,r:u.length}};XLSX.utils.sheet_add_aoa(o,u),o["!ref"]=XLSX.utils.encode_range(t);var n=e();return n.length&&(o["!merges"]=n),o}()}var s,a=this,l=e.sheetName||"Sheet1",u={SheetNames:[],Sheets:{}},c=[];if(console.log("data",t),e.sheetOnly)return void n(r());if(e.sheets)for(var p in e.sheets)!0===e.sheets[p]?(u.SheetNames.push(p),u.Sheets[p]=r()):(u.SheetNames.push(p),this.table.modules.comms.send(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},intercept:function(o){u.Sheets[p]=o}}));else u.SheetNames.push(l),u.Sheets[l]=r();s=XLSX.write(u,{bookType:"xlsx",bookSST:!0,type:"binary"}),n(function(o){for(var t=new ArrayBuffer(o.length),e=new Uint8Array(t),n=0;n!=o.length;++n)e[n]=255&o.charCodeAt(n);return t}(s),"application/octet-stream")}},Tabulator.prototype.registerModule("download",Download);