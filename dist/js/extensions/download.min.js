/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Download=function(t){this.table=t,this.fields={},this.columnsByIndex=[],this.columnsByField={}};Download.prototype.download=function(t,e,o,n){function i(o,i){n?n(o):a.triggerDownload(o,i,t,e)}var a=this,s=!1;"function"==typeof t?s=t:a.downloaders[t]?s=a.downloaders[t]:console.warn("Download Error - No such download type found: ",t),this.processColumns(),s&&s.call(this,a.processDefinitions(),a.processData(),o||{},i)},Download.prototype.processColumns=function(){var t=this;t.columnsByIndex=[],t.columnsByField={},t.table.columnManager.columnsByIndex.forEach(function(e){e.field&&e.visible&&!1!==e.definition.download&&(t.columnsByIndex.push(e),t.columnsByField[e.field]=e)})},Download.prototype.processDefinitions=function(){var t=this,e=[];return t.columnsByIndex.forEach(function(t){var o=t.definition;if(!1!==t.download){var n={};for(var i in o)n[i]=o[i];void 0!==o.downloadTitle&&(n.title=o.downloadTitle),e.push(n)}}),e},Download.prototype.processData=function(){var t=this,e=t.table.rowManager.getData(!0,"download");return"function"==typeof t.table.options.downloadDataFormatter&&(e=t.table.options.downloadDataFormatter(e)),e},Download.prototype.triggerDownload=function(t,e,o,n){var i=document.createElement("a"),a=new Blob([t],{type:e}),n=n||"Tabulator."+("function"==typeof o?"txt":o);(a=this.table.options.downloadReady(t,a))&&(navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(i.setAttribute("href",window.URL.createObjectURL(a)),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)),this.table.options.downloadComplete&&this.table.options.downloadComplete())},Download.prototype.getFieldValue=function(t,e){var o=this.columnsByField[t];return!!o&&o.getFieldValue(e)},Download.prototype.commsReceived=function(t,e,o){switch(e){case"intercept":this.download(o.type,"",o.options,o.intercept)}},Download.prototype.downloaders={csv:function(t,e,o,n){var i,a=this,s=[],r=[],l=o&&o.delimiter?o.delimiter:",";t.forEach(function(t){t.field&&(s.push('"'+String(t.title).split('"').join('""')+'"'),r.push(t.field))}),i=[s.join(l)],e.forEach(function(t){var e=[];r.forEach(function(o){var n=a.getFieldValue(o,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}e.push('"'+String(n).split('"').join('""')+'"')}),i.push(e.join(l))}),n(i.join("\n"),"text/csv")},json:function(t,e,o,n){n(JSON.stringify(e,null,"\t"),"application/json")},pdf:function(t,e,o,n){var i=this,a=[],s=[],r=[],l=o&&o.autoTable?o.autoTable:{},d=o&&o.title?o.title:"",u=o&&"portrait"==o.orientation?"p":"l";t.forEach(function(t){t.field&&(s.push(t.title||""),a.push(t.field))}),e.forEach(function(t){var e=[];a.forEach(function(o){var n=i.getFieldValue(o,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}e.push(n)}),r.push(e)});var c=new jsPDF(u,"pt");d&&(l.addPageContent=function(t){c.text(d,40,30)}),c.autoTable(s,r,l),n(c.output("arraybuffer"),"application/pdf")},xlsx:function(t,e,o,n){function i(){var o=[],n=[],i=[];return t.forEach(function(t){t.field&&(o.push(t.title),n.push(t.field))}),i.push(o),e.forEach(function(t){var e=[];n.forEach(function(o){e.push(s.getFieldValue(o,t))}),i.push(e)}),function(){var t={},e={s:{c:0,r:0},e:{c:n.length,r:i.length}};return XLSX.utils.sheet_add_aoa(t,i),t["!ref"]=XLSX.utils.encode_range(e),t}()}var a,s=this,r=o.sheetName||"Sheet1",l={SheetNames:[],Sheets:{}};if(o.sheetOnly)return void n(i());if(o.sheets)for(var d in o.sheets)!0===o.sheets[d]?(l.SheetNames.push(d),l.Sheets[d]=i()):(l.SheetNames.push(d),this.table.extensions.comms.send(o.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},intercept:function(t){l.Sheets[d]=t}}));else l.SheetNames.push(r),l.Sheets[r]=i();a=XLSX.write(l,{bookType:"xlsx",bookSST:!0,type:"binary"}),n(function(t){for(var e=new ArrayBuffer(t.length),o=new Uint8Array(e),n=0;n!=t.length;++n)o[n]=255&t.charCodeAt(n);return e}(a),"application/octet-stream")}},Tabulator.registerExtension("download",Download);