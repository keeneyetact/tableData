/* Tabulator v4.0.0 (c) Oliver Folkerd */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Download=function(t){this.table=t,this.fields={},this.columnsByIndex=[],this.columnsByField={}};Download.prototype.download=function(t,o,e,n){function i(e,i){n?n(e):a.triggerDownload(e,i,t,o)}var a=this,r=!1;"function"==typeof t?r=t:a.downloaders[t]?r=a.downloaders[t]:console.warn("Download Error - No such download type found: ",t),this.processColumns(),r&&r.call(this,a.processDefinitions(),a.processData(),e||{},i)},Download.prototype.processColumns=function(){var t=this;t.columnsByIndex=[],t.columnsByField={},t.table.columnManager.columnsByIndex.forEach(function(o){o.field&&o.visible&&!1!==o.definition.download&&(t.columnsByIndex.push(o),t.columnsByField[o.field]=o)})},Download.prototype.processDefinitions=function(){var t=this,o=[];return t.columnsByIndex.forEach(function(t){var e=t.definition;if(!1!==t.download){var n={};for(var i in e)n[i]=e[i];void 0!==e.downloadTitle&&(n.title=e.downloadTitle),o.push(n)}}),o},Download.prototype.processData=function(){var t=this,o=t.table.rowManager.getData(!0,"download");return"function"==typeof t.table.options.downloadDataFormatter&&(o=t.table.options.downloadDataFormatter(o)),o},Download.prototype.triggerDownload=function(t,o,e,n){var i=document.createElement("a"),a=new Blob([t],{type:o}),n=n||"Tabulator."+("function"==typeof e?"txt":e);(a=this.table.options.downloadReady(t,a))&&(navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(i.setAttribute("href",window.URL.createObjectURL(a)),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)),this.table.options.downloadComplete&&this.table.options.downloadComplete())},Download.prototype.getFieldValue=function(t,o){var e=this.columnsByField[t];return!!e&&e.getFieldValue(o)},Download.prototype.commsReceived=function(t,o,e){switch(o){case"intercept":this.download(e.type,"",e.options,e.intercept)}},Download.prototype.downloaders={csv:function(t,o,e,n){var i,a=this,r=[],s=[],l=e&&e.delimiter?e.delimiter:",";t.forEach(function(t){t.field&&(r.push('"'+String(t.title).split('"').join('""')+'"'),s.push(t.field))}),i=[r.join(l)],o.forEach(function(t){var o=[];s.forEach(function(e){var n=a.getFieldValue(e,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}o.push('"'+String(n).split('"').join('""')+'"')}),i.push(o.join(l))}),n(i.join("\n"),"text/csv")},json:function(t,o,e,n){n(JSON.stringify(o,null,"\t"),"application/json")},pdf:function(t,o,e,n){var i=this,a=[],r=[],s=[],l=e&&e.autoTable?e.autoTable:{},d=e&&e.title?e.title:"",u=e&&"portrait"==e.orientation?"p":"l";t.forEach(function(t){t.field&&(r.push(t.title||""),a.push(t.field))}),o.forEach(function(t){var o=[];a.forEach(function(e){var n=i.getFieldValue(e,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}o.push(n)}),s.push(o)});var c=new jsPDF(u,"pt");d&&(l.addPageContent=function(t){c.text(d,40,30)}),c.autoTable(r,s,l),n(c.output("arraybuffer"),"application/pdf")},xlsx:function(t,o,e,n){function i(){var e=[],n=[],i=[];return t.forEach(function(t){t.field&&(e.push(t.title),n.push(t.field))}),i.push(e),o.forEach(function(t){var o=[];n.forEach(function(e){o.push(r.getFieldValue(e,t))}),i.push(o)}),function(){var t={},o={s:{c:0,r:0},e:{c:n.length,r:i.length}};return XLSX.utils.sheet_add_aoa(t,i),t["!ref"]=XLSX.utils.encode_range(o),t}()}var a,r=this,s=e.sheetName||"Sheet1",l={SheetNames:[],Sheets:{}};if(e.sheetOnly)return void n(i());if(e.sheets)for(var d in e.sheets)!0===e.sheets[d]?(l.SheetNames.push(d),l.Sheets[d]=i()):(l.SheetNames.push(d),this.table.extensions.comms.send(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},intercept:function(t){l.Sheets[d]=t}}));else l.SheetNames.push(s),l.Sheets[s]=i();a=XLSX.write(l,{bookType:"xlsx",bookSST:!0,type:"binary"}),n(function(t){for(var o=new ArrayBuffer(t.length),e=new Uint8Array(o),n=0;n!=t.length;++n)e[n]=255&t.charCodeAt(n);return o}(a),"application/octet-stream")}},Tabulator.prototype.registerExtension("download",Download);